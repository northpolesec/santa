---
sidebar_position: 1
---

# Common Expression Language (CEL)

import AddedBadge from "@site/src/components/AddedBadge/AddedBadge";
import PlaygroundLink from "@site/src/components/CELPlayground/PlaygroundLink";

This page lists well-known and/or community-contributed CEL expressions.

CEL ([Common Expression Language](https://cel.dev/)) rules allow for more
complex policies than would normally be possible. Read how to configure CEL
rules in the [Binary Authorization](/features/binary-authorization#cel)
documentation.

## Apps signed since X

This will prevent executions of an app where the specific binary was signed
before the provided date. This is particularly useful when attached to a
`TEAMID` or `SIGNINGID` rule.

```clike
target.signing_time >= timestamp('2025-05-31T00:00:00Z')
```

<PlaygroundLink
  expression={`target.signing_time >= timestamp('2025-05-31T00:00:00Z')`}
  context={`
    target:
      signing_time: "2025-06-01T00:00:00Z"
    args:
      - "--version"
    envs:
      HOME: "/Users/admin"
    euid: 501
    cwd: "/Applications"
  `}
/>

## Prevent users from disabling gatekeeper

Create a signing ID rule for `platform:com.apple.spctl` and attach the following CEL program

```clike
[
    '--global-disable',
    '--master-disable',
    '--disable',
    '--add',
    '--remove'
].exists(flag, flag in args) ? BLOCKLIST : ALLOWLIST
```

<PlaygroundLink
  expression={`
    [
        '--global-disable',
        '--master-disable',
        '--disable',
        '--add',
        '--remove'
    ].exists(flag, flag in args) ? BLOCKLIST : ALLOWLIST
  `}
  context={`
    args:
      - "--master-disable"
    envs:
      HOME: "/Users/admin"
    euid: 0
    cwd: "/Users/admin"
  `}
/>

## Prevent Timestomping of LaunchAgents and LaunchDaemons <AddedBadge added={"Santa 2025.8"} />

Malware like those produced by the Chollima groups use "timestomping" to reset the
timestamps of LaunchAgents and LaunchDaemons using touch. This can be prevented
/ detected by creating a SigningID rule for `platform:com.apple.touch` with the
following CEL program.

This technique was recently discussed by [Jaron
Bradely](https://themittenmac.com/author/jaron-bradley/) at [Objective by the
Sea v8](https://objectivebythesea.org/v8/talks.html#Speaker_24)

```clike
args.exists(arg, arg in [
  '-a', '-m', '-r', '-A', '-t'
]) && args.join(" ").contains("Library/Launch") ? BLOCKLIST : ALLOWLIST
```

<PlaygroundLink
  expression={`
    args.exists(arg, arg in [
      '-a', '-m', '-r', '-A', '-t'
    ]) && args.join(" ").contains("Library/Launch") ? BLOCKLIST : ALLOWLIST
  `}
  context={`
    args:
      - "-t"
      - "202301010000"
      - "/Users/admin/Library/LaunchAgents/com.malware.plist"
    envs:
      HOME: "/Users/admin"
    euid: 501
    cwd: "/Users/admin"
  `}
/>

Note this will not stop using the system calls directly or otherwise
programmatically modifying the timestamps. Also this won't cover modifications
if the process' current working directory is already in the LaunchDaemons /
LaunchAgents directories.

## Prevent OSAScript From Popping Password Dialogs <AddedBadge added={"Santa 2025.8"} />

A lot of malware on macOS will attempt to get users to enter their passwords
into a dialog box via osascript. This is a basic rule to stop directly asking
for a password dialog.

Make a SigningID rule for `platform:com.apple.osascript` with the following CEL
Program

```clike
(
    args.join(" ").lowerAscii().matches(".*\\W+with\\W+hidden\\W+answer.*") ||
    args.join(" ").lowerAscii().contains("password")
) &&
    args.join(" ").lowerAscii().matches(
        ".*\\W+display\\W+dialog.*")  ? BLOCKLIST : ALLOWLIST
```

<PlaygroundLink
  expression={`
    (
        args.join(" ").lowerAscii().matches(".*\\\\W+with\\\\W+hidden\\\\W+answer.*") ||
        args.join(" ").lowerAscii().contains("password")
    ) &&
        args.join(" ").lowerAscii().matches(
            ".*\\\\W+display\\\\W+dialog.*")  ? BLOCKLIST : ALLOWLIST
  `}
  context={`
    args:
      - "-e"
      - 'display dialog "Enter your password" with hidden answer default answer ""'
    envs:
      HOME: "/Users/admin"
    euid: 501
    cwd: "/Users/admin"
  `}
/>

Note: This will not stop obfuscated osascript that's evaluated at runtime or
any other malicious behavior triggered through osascript. For better security
block osascript all together if you can.  Be aware software like the Google
Cloud SDK installer and AI tools like claude code use osascript.

Also if you're using osascript to do this legitimately this will break your
usage.

## Prevent users from enabling SSH and Remote Apple Events <AddedBadge added={"Santa 2025.8"} />

As called out in [loobins](https://www.loobins.io/binaries/systemsetup/) the
systemsetup command can be used to enable SSH and Remote Apple Events via
command line options.

To block this create a signing ID rule for `platform:com.apple.systemsetup` and
attach the following CEL program:

```clike
args.join(" ").contains("-setremotelogin on") ||
args.join(" ").contains("-setremoteappleevents on") ? BLOCKLIST : ALLOWLIST
```

<PlaygroundLink
  expression={`
    args.join(" ").contains("-setremotelogin on") ||
    args.join(" ").contains("-setremoteappleevents on") ? BLOCKLIST : ALLOWLIST
  `}
  context={`
    args:
      - "-setremotelogin"
      - "on"
    envs:
      HOME: "/Users/admin"
    euid: 0
    cwd: "/Users/admin"
  `}
/>

## Prevent Users from Taking and Mounting Time Machine Snapshots

As was presented at [Kawaiicon 2025](https://kawaiicon.org/) by [Calum Hall](https://www.youtube.com/watch?v=hIeNuqq12sk&t=1390s), Time Machine snapshots can be used to bypass [File Access Authorization rules](https://www.youtube.com/watch?v=hIeNuqq12sk&t=1390s).

You can stop the taking of local snapshots by creating a signing ID for
`platform:com.apple.tmutil` and attaching the following CEL program:

```clike
'localsnapshot' in args ? BLOCKLIST : ALLOWLIST
```

<PlaygroundLink
  expression={`'localsnapshot' in args ? BLOCKLIST : ALLOWLIST`}
  context={`
    args:
      - "localsnapshot"
    envs:
      HOME: "/Users/admin"
    euid: 0
    cwd: "/Users/admin"
  `}
/>

This will break taking local snapshots via the command line. Alternatively if
you need to still be able to take time machine snapshots but don't want users
to mount them locally you can stop the mount of local snapshots with a signing
ID rule `platform:com.apple.mount_apfs` with the following CEL program


```clike
('-s' in args &&
  args.exists(arg, arg.contains("com.apple.TimeMachine."))) ? BLOCKLIST : ALLOWLIST
```

<PlaygroundLink
  expression={`
    ('-s' in args &&
      args.exists(arg, arg.contains("com.apple.TimeMachine."))) ? BLOCKLIST : ALLOWLIST
  `}
  context={`
    args:
      - "-s"
      - "com.apple.TimeMachine.2025-06-01-120000.local"
      - "/"
      - "/tmp/snapshot"
    envs:
      HOME: "/Users/admin"
    euid: 0
    cwd: "/Users/admin"
  `}
/>
